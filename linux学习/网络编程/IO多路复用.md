IO多路复用:



Linux下主要有以下四种IO模型：

1. 阻塞IO模型（Blocking IO）：当用户进程发起IO请求后，内核会一直等待，直到IO操作完成并将数据拷贝到用户空间，用户进程才能继续执行。
2. 非阻塞IO模型（Non-blocking IO）：当用户进程发起IO请求后，内核会立即返回一个错误码，表示IO操作还未完成，用户进程可以继续执行其他任务。用户进程需要不断地轮询IO操作是否完成。
3. IO复用模型（IO multiplexing）：用户进程将多个IO请求注册到同一个select/poll/epoll调用中，内核会阻塞用户进程，直到有任意一个IO请求完成，或者超时，或者出错，然后返回就绪的IO描述符。用户进程可以通过遍历就绪的IO描述符来完成数据的读写操作。
4. 异步IO模型（Asynchronous IO）：用户进程发起IO请求后，内核会立即返回，然后内核会在IO操作完成后，通知用户进程。用户进程可以继续执行其他任务，IO操作完成后，内核会将数据拷贝到用户空间。



阻塞模式的实现通常涉及以下步骤：



1. 设置文件描述符为非阻塞模式，可以通过fcntl函数的F_SETFL命令实现。例如：



```
int flags = fcntl(fd, F_GETFL, 0);
fcntl(fd, F_SETFL, flags | O_NONBLOCK);
```



1. 发起IO请求，例如读取数据。如果数据还未准备好，会立即返回一个错误码（例如EAGAIN或EWOULDBLOCK），表示IO操作还未完成。
2. 如果IO操作返回了错误码，可以通过轮询或者select/poll/epoll等IO复用模型来等待IO操作完成。
3. 当IO操作完成后，可以通过读取返回值或者errno来确定IO操作的状态，并根据需要进行处理。

select实现过程:

好的，以下是整合后的内容，包括常用的与select函数相关的函数以及它们的参数说明，以及使用select函数实现多路复用的流程和注意事项：



1. FD_ZERO函数



```
void FD_ZERO(fd_set *set);
```



参数说明：



- set：需要清空的文件描述符集合指针。



1. FD_SET函数



```
void FD_SET(int fd, fd_set *set);
```



参数说明：



- fd：需要添加到文件描述符集合中的文件描述符。
- set：需要添加文件描述符的文件描述符集合指针。



1. FD_CLR函数



```
void FD_CLR(int fd, fd_set *set);
```



参数说明：



- fd：需要从文件描述符集合中删除的文件描述符。
- set：需要删除文件描述符的文件描述符集合指针。



1. FD_ISSET函数



```
int FD_ISSET(int fd, fd_set *set);
```



参数说明：



- fd：需要判断的文件描述符。
- set：需要判断的文件描述符集合指针。



返回值说明：



- 如果文件描述符fd在集合set中，返回非零值（一般为1）；否则返回0。



1. select函数



```
int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);
```



参数说明：



- nfds：需要监视的文件描述符中最大的文件描述符加1。
- readfds：需要监视读事件的文件描述符集合指针。
- writefds：需要监视写事件的文件描述符集合指针。
- exceptfds：需要监视异常事件的文件描述符集合指针。
- timeout：等待超时时间，如果为NULL，则一直等待，直到有文件描述符就绪。



返回值说明：



- 如果有文件描述符就绪，返回就绪的文件描述符数量；如果超时返回0；如果出错返回-1。



使用select函数实现多路复用的流程如下：



1. 创建需要监视的文件描述符集合，将需要监视的文件描述符添加到集合中，并指定需要监视的IO事件类型。可以使用FD_ZERO、FD_SET、FD_CLR等函数对文件描述符集合进行操作。
2. 调用select函数，等待文件描述符集合中的文件描述符就绪。可以使用select函数指定需要监视的文件描述符集合、超时时间等参数，并在返回时获取就绪的文件描述符数量。
3. 当select函数返回时，遍历文件描述符集合，确定哪些文件描述符已经就绪，以便进行相应的IO操作。可以使用FD_ISSET函数判断某个文件描述符是否已经就绪，并进行相应的IO操作。
4. 在下一次调用select函数之前，需要重新设置文件描述符集合，将需要监视的文件描述符重新添加到集合中，以便进行下一轮的监视。可以使用FD_ZERO、FD_SET等函数重新设置文件描述符集合。

- 在使用select函数实现多路复用时，通常需要使用fd_set数据类型来表示文件描述符集合。fd_set是一个位向量，可以用一个二进制位表示一个文件描述符是否在集合中。可以使用FD_ZERO、FD_SET、FD_CLR等函数对fd_set进行操作。
- 在实际使用中，通常需要将多个文件描述符添加到同一个fd_set中，然后调用select函数等待其中一个文件描述符就绪，以便进行相应的IO操作。可以使用FD_SET函数将一个文件描述符添加到fd_set中，使用FD_CLR函数将一个文件描述符从fd_set中删除。在调用select函数时，需要将需要监视的文件描述符集合作为参数传递给select函数。
- 在select函数返回时，可以使用FD_ISSET函数遍历文件描述符集合，确定哪些文件描述符已经就绪，并进行相应的IO操作。FD_ISSET函数可以判断一个文件描述符是否已经就绪，如果已经就绪，返回true，否则返回false。
- 最后，在下一次调用select函数之前，需要使用FD_ZERO、FD_SET等函数重新设置文件描述符集合，将需要监视的文件描述符重新添加到集合中，以便进行下一轮的监视。