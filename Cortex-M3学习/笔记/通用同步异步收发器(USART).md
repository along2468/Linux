# 串口通信原理-UART

​        UART是通用异步收发传输器。

​        UART包含TTL电平和RS-232电平两种，嵌入式系统里面，单片机的串口一般都是TTL电平，UART因为有两根线数据线TX和RX，可以以全双工的形式进行发送和接收数据，同一时刻，两条链路的发送器和接收器可以同时传输数据。区别于全双工，还有单工和半双工通信。

​        单工下只允许单向传输数据，而半双工相当于单刀双掷开关，同一时刻只能传输或接收。



UART数据帧格式

其中各位的含义如下：

- **起始位**：发送1位逻辑0（低电平），开始传输数据。
- **数据位**：可以是5~8位的数据，先发低位，再发高位，一般常见的就是8位（1个字节），其他的如7位的ASCII码。
- **校验位**：奇偶校验，将数据位加上校验位，1的位数为偶数（偶校验），1的位数4为奇数（奇校验）。
- **停止位**：停止位是数据传输结束的标志，可以是1/1.5/2位的逻辑1（高电平）。
- **空闲位**：空闲时数据线为高电平状态，代表无数据传输

### 通用同步异步收发器USART

<img src="D:\Git\git-space\Cortex-M3学习\imgs\image-20230413220848434.png" alt="image-20230413220848434" style="zoom:80%;" />

​        通用同步异步收发器(USART)提供了一种灵活的方法与使用工业标准NRZ异步串行数据格式的外部设备之间进行全双工数据交换。USART利用分数波特率发生器提供宽范围的波特率选择。它支持同步单向通信和半双工单线通信，使用多缓冲器配置的DMA方式，可以实现高速数据通信。

​      任何USART双向通信至少需要两个脚：接收数据输入(RX)和发送数据输出(TX)。

​     RX：接收数据串行输。通过过采样技术来区别数据和噪音，从而恢复数据。

​      TX：发送数据输出。当发送器被禁止时，输出引脚恢复到它的I/O端口配置。当发送器被激活，

并且不发送数据时，TX引脚处于高电平。在单线和智能卡模式里，此I/O口被同时用于数据的发

送和接收。

###### USART框图

<img src="D:\Git\git-space\Cortex-M3学习\imgs\image-20230413221521460.png" alt="image-20230413221521460" style="zoom:80%;" />

###### 数据寄存器

​        USART 数据寄存器 (USART_DR) 只有低 9 位有效，并且第 9 位数据是否有效要取决于 USART 控制寄存器 1(USART_CR1) 的 M 位设置，当 M 位为 0 时表示 8 位数据字长，当 M 位为 1 表示 9 位数据字长，我们一般使用 8 位数据字长。

​        USART_DR 包含了已发送的数据或者接收到的数据。 USART_DR 实际是包含了两个寄存器，一个专门用于发送的可写 TDR，一个专门用于接收的可读 RDR。当进行发送操作时，往 USART_DR 写入数据会自动存储在 TDR 内；当进行读取操作时，向 USART_DR 读取数据会自动提取 RDR 数据。

​        TDR 和 RDR 都是介于系统总线和移位寄存器之间。串行通信是一个位一个位传输的，发送时把 TDR 内容转移到发送移位寄存器，然后把移位寄存器数据每一位发送出去，接收时把接收到的每一位顺序保存在接收移位寄存器内然后才转移到 RDR。

​        USART 支持 DMA 传输，可以实现高速数据传输。