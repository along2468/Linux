## IIC通信协议

IIC总线是由Philips公司开发的一种通用数据总线

两根通信线:SCL(Serial Clock)、SDA(Serial Data)

同步、半双工

带数据应答

支持总线挂载多设备(一主多从、多主多从)

硬件电路:

所有IIC设备的SCL连在一起,SDA连在一起

设备的SCL和SDA均要配置成开楼输出模式

SCL和SDA各添加一个上拉电阻,阻值一般为4.7KΩ左右

IIC时序基本单元

起始条件:SCL高电平期间,SDA从高电平切换到低电平

终止条件:SCL高电平期间,SDA从低电平切换到高电平

![image-20230706234846262](C:\Users\ALong\AppData\Roaming\Typora\typora-user-images\image-20230706234846262.png)

发送一个字节:SCL低电平期间,主机将数据位依次放到SDA线上(高位先行),然后释放SCL,从机将在SCL高电平期间读取数据位,所以SCL高电平期间SDA不允许有数据变化,一次循环上述过程8次,即可发送一个字节. 

![image-20230706234909425](C:\Users\ALong\AppData\Roaming\Typora\typora-user-images\image-20230706234909425.png)

接收一个字节:SCL低电平期间,从机将数据放到SDA线上,然后释放SCL,主机将在SCL高电平期间读取数据位,所以SCL高电平期间,SDA不允许有数据变化,依次循环上述过程8次,即可接受一个字节(主机在接收之前,需要释放SDA)

发送应答:主机在接收完一个字节之后,在下一个时钟发送一位数据,数据0表示应答,数据1表示非应答

接收应答:主机在发送一个字节数据之后,在下一个时钟接收一位数据,判断从机是否应答,数据0表示应答,数据1表示非应答(主机在接收之前,需要释放SDA)



指定地址写:对于指定设备,在指定地址下写入数据

![image-20230707000917187](C:\Users\ALong\AppData\Roaming\Typora\typora-user-images\image-20230707000917187.png)

在S区间,SCL高电平,SDA由高电平转为低电平,表示这是起始条件

紧着这8位包括7位的设备地址和一位的读或写操作,由时序图可以得知,这个设备地址是1101000  第8位是0代表写操作

RA区间,在主机发送了8位后,需要接着一个应答位,SCL为高电平,SDA为低电平表示从机应答.

Reg Address区间表示指定地址00011001,之后是一个应答位SDA低电平表示成功应答,在之后是8位是要写入的数据10101010

P区间,SCL高电平,SDA由低电平转为高电平表示终止

当前地址读:

对于指定设备,在当前地址指针指示的地址下,读取从机数据

指定地址读:

对于指定设备,在指定地址下,读取从机数据

![image-20230707003103967](C:\Users\ALong\AppData\Roaming\Typora\typora-user-images\image-20230707003103967.png)